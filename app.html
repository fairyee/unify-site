<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>이미지 편집기</title>

<style>
body {
  font-family: sans-serif;
  padding: 20px;
  background: #fafafa;
}

#resultBox img{
  max-width: 200px;
  margin: 4px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.box{
  display:inline-flex;
  flex-direction:column;
  align-items:center;
  margin:8px;
}

button{
  padding: 6px 14px;
  margin-top: 4px;
}

</style>

</head>
<body>

<h2>이미지 편집기</h2>

<form id="editForm">
  <input type="file" name="images" id="images" multiple><br><br>
  <button type="submit">이미지 편집하기</button>
</form>

<hr>

<h3>결과</h3>
<div id="resultBox"></div>

<script>
const form = document.getElementById("editForm");
const resultBox = document.getElementById("resultBox");

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  resultBox.innerHTML = "처리중...";

  const fd = new FormData();
  const files = document.getElementById("images").files;
  for(let f of files){
    fd.append("images", f);
  }

  const res = await fetch("/api/unify", {
    method:"POST",
    body:fd,
  });

  const data = await res.json();
  resultBox.innerHTML = "";

  // 이미지 + 다운로드 버튼
  data.images.forEach((src, index) => {

    const wrap = document.createElement("div");
    wrap.className = "box";

    const img = document.createElement("img");
    img.src = src;

    const btn = document.createElement("button");
    btn.textContent = "다운로드";
    btn.addEventListener("click", ()=>{
      const a = document.createElement("a");
      a.href = src;
      a.download = `edited-${index+1}.png`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

    wrap.appendChild(img);
    wrap.appendChild(btn);
    resultBox.appendChild(wrap);
  });

});
</script>

</body>
</html>
